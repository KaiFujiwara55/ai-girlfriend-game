# 開発ガイドライン

## 設計原則

### 1. 抽象化とモジュラリティ
- **AIプロバイダー抽象化**: 複数のAIサービス（Claude、OpenAI、Gemini）を統一インターフェースで扱う
- **システム分離**: 感情システム、会話管理、プロンプト生成を独立したモジュールとして設計
- **ファクトリーパターン**: AIプロバイダーの動的生成と切り替え

### 2. 型安全性とエラーハンドリング
- **厳格な型定義**: すべての関数、変数に明示的な型注釈
- **async/awaitパターン**: Promise ベースの非同期処理
- **包括的エラーハンドリング**: try-catchによる適切なエラーキャッチ

### 3. データ管理
- **不変性**: 感情状態やゲーム状態の安全な更新
- **履歴管理**: 会話履歴の永続化と検索機能
- **設定の外部化**: 環境変数による設定管理

## 特有の実装パターン

### キャラクター設定
- 詳細な性格プロフィール（背景、価値観、話し方）
- 感情変動パターンの個別定義
- 関係性段階別の反応パターン

### プロンプトエンジニアリング
- キャラクター固有の詳細プロンプト（1500文字以上）
- 会話履歴とコンテキストの動的統合
- 感情状態に基づく応答調整

### 感情システム
- 5軸感情管理（mood, trust, tension, affection, interest）
- 話題カテゴリによる感情変動ルール
- 関係性段階の自動進行判定

## テスト戦略
- **単体テスト**: 各システムの独立テスト
- **統合テスト**: システム間連携の確認
- **シミュレーションテスト**: 自動会話による動作確認
- **ライブテスト**: 実際のAPI呼び出しテスト

## 拡張性への配慮
- 新しいAIプロバイダーの追加容易性
- キャラクター追加の簡便性
- 新機能追加時の既存機能への影響最小化